<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
  <meta charset="UTF-8">
  <title>Empty</title>
  <th:block layout:fragment="css">
    <!--사용할 css는 여기에 첨부 -->
    <link rel="stylesheet" type="text/css" href="/css/empty.css">
    <link rel="stylesheet" type="text/css" href="/css/noticeDept/noticeDetailWriteEdit.css">
  </th:block>
</head>
<body layout:fragment="content">
<div id="fullscreen">
  <div id="_emt1"></div>
  <div id="_emt2">
    <div id="_emt3">
    </div>
    <div id="_emt4">
      <div id="use_screen">
        <!--헤더와 메뉴바를 제외한 영역 -->
        <!--여기에 본인의 코드를 넣어주시면 됩니다 -->
        <div class="noticeTitle">
          <p >공지 게시판</p>
        </div>
        <div class="board_wrap">
          <div class="board_write_wrap">
            <form method="post" enctype="multipart/form-data">
              <div class="board_write">
                <div class="title">
                  <dl>
                    <dt>제목</dt>
                    <dd><input type="text" placeholder="제목 입력" name="title"></dd>
                  </dl>
                </div>
                <div class="info">
                  <dt style="margin-left: 10px">첨부파일</dt>
                  <div class="file_list">
                    <div class="file_select">
                      <div class="file_input">
                        <label class="file_input" for="file_input_label">
                          <label id="file_input_label_btn">
                            <input type="file" name="files" id="file_input_label" onchange="selectFile(this);" />
                          </label>
                        </label>
                        <button type="button" onclick="addFile();" class="fn_add_btn"><span>추가</span></button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="cont">
                  <textarea placeholder="내용 입력" name="content"></textarea>
                </div>
              </div>
              <div class="bt_wrap">
                <button type="submit" class="on">등록</button>
                <a th:href="@{/noticeDept/list}"><button type="button">취소</button></a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function selectFile(element) {

    const file = element.files[0];
    const filename = element.closest('.file_input').firstElementChild;

    // 1. 파일 선택 창에서 취소 버튼이 클릭된 경우
    if ( !file ) {
      filename.value = '';
      return false;
    }

    // 2. 파일 크기가 10MB를 초과하는 경우
    const fileSize = Math.floor(file.size / 1024 / 1024);
    if (fileSize > 10) {
      alert('10MB 이하의 파일로 업로드해 주세요.');
      filename.value = '';
      element.value = '';
      return false;
    }

    // 3. 파일명 지정
    filename.value = file.name;
  }

  // 파일 추가
  function addFile() {
    const fileDiv = document.createElement('div');
    fileDiv.innerHTML =`
            <div class="file_input" for="file_input_label">
                <label id="file_input_label_btn">첨부파일
                    <input type="file" name="files" onchange="selectFile(this);" id="file_input_label"/>
                </label>
                <button type="button" onclick="removeFile(this);" class="file_del_btn" style="margin-left: 45px; width: 35px" ><span>삭제</span></button>
            </div>
        `;
    document.querySelector('.file_list').appendChild(fileDiv);
  }


  // 파일 삭제
  function removeFile(element) {
    const fileAddBtn = element.nextElementSibling;
    if (fileAddBtn) {
      const inputs = element.previousElementSibling.querySelectorAll('input');
      inputs.forEach(input => input.value = '')
      return false;
    }
    element.parentElement.remove();
  }

  const cancel_elements = document.getElementsByClassName("cancel");
  Array.from(cancel_elements).forEach(function(ele) {
    ele.addEventListener('click', function() {
      if(confirm("정말로 작성을 취소하시겠습니까?")) {
        location.href = this.dataset.uri;
      };
    });
  });

  // 등록 버튼 클릭 시 중복 클릭 방지 및 필수 입력 확인
  document.querySelector('.bt_wrap button[type="submit"]').addEventListener('click', function(event) {
    event.preventDefault();  // 기본 동작인 폼 제출을 막습니다.

    var button = this;
    button.disabled = true;  // 버튼 비활성화

    // 제목 필드 값 확인
    var titleInput = document.querySelector('input[name="title"]');
    var titleValue = titleInput.value.trim();  // 제목 값에서 앞뒤 공백 제거

    // 내용 필드 값 확인
    var contentTextarea = document.querySelector('textarea[name="content"]');
    var contentValue = contentTextarea.value.trim();  // 내용 값에서 앞뒤 공백 제거

    // 제목 또는 내용이 입력되지 않은 경우
    if (titleValue === '' || contentValue === '') {
      alert('제목과 내용을 모두 입력해주세요.');  // 안내 메시지 표시
      button.disabled = false;  // 버튼 활성화
      return;  // 함수 종료
    }

    // 기존의 폼 제출 동작을 지연시키고 중복 클릭 방지 후 처리를 수행합니다.
    setTimeout(function() {
      button.disabled = false;  // 버튼 다시 활성화
      button.closest('form').submit();  // 폼 제출

      // 등록 완료 알림 표시
      alert('등록되었습니다.');
    }, 1000);  // 적절한 지연 시간을 설정합니다. 이 예제에서는 1초(1000ms)입니다.
  });
</script>
</body>
<th:block layout:fragment="script">
  <!--사용할 자바스크립트는 여기에 첨부 -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</th:block>
</html>