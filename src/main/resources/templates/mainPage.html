<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">
        <link rel="stylesheet" type="text/css" href="/css/main.css">
    </th:block>
</head>
<body layout:fragment="content">
<div id="fullscreen">
    <div id="_emt1"></div>
    <div id="_emt2">
        <div id="_emt3">
        </div>
        <div id="_emt4">
            <div class="a_screen1"></div>
            <div id="a_screen2">
                <div id="b_screen">
                    <div id="b_screen_1">
                        <div id="b_screen_1_1">
                            <div class="shadow">
                                <div class="com_title">
                                    <div class="title">
                                        <h4 class="title_text">출퇴근</h4>
                                    </div>
                                </div>
                                <div id="com_content_on_off">
                                    <div id="user_on_off_div">
                                        <table id="usertable">
                                            <tr>
                                                <td rowspan="3" id="img_td">
                                                    <div id="user_img_div">
                                                        <img th:src="@{'/upload/' + ${user.USERIMAGE}}" alt="프로필 사진" id="user_img">
                                                    </div>
                                                </td>
                                                <td class="userinfo_div_th">이름</td>
                                                <td class="userinfo_div_td" th:text="${session.user.USERNAME}"></td>
                                            </tr>
                                            <tr>
                                                <td class="userinfo_div_th">사번</td>
                                                <td class="userinfo_div_td" th:text="${session.user.USERENO}"></td>
                                            </tr>
                                            <tr>
                                                <td class="userinfo_div_th">부서</td>
                                                <td class="userinfo_div_td" th:text="${session.user.USERDEPT}"></td>
                                            </tr>
                                            <tr>
                                                <td colspan="3" class="on_off_div">
                                                    <div class="on_off_btn_div1">
                                                        <div class="on_off_btn_div2">
                                                            <button id="on" class="onoff_btn">출근</button>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="3" class="on_off_div">
                                                    <div class="on_off_btn_div1">
                                                        <div class="on_off_btn_div2">
                                                            <button id="off" class="onoff_btn">퇴근</button>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="3" class="on_off_div" id="on_text">출근 시각</td>
                                            </tr>
                                            <tr>
                                                <td colspan="3" class="on_off_div" id="off_text">퇴근 시각</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="b_screen_2">
                        <div class="shadow">
                            <div class="com_title">
                                <div class="title">
                                    <h4 class="title_text">업무 시간</h4>
                                </div>
                            </div>
                            <div class="com_content">
                                <div id="b_screen_2_1">
                                    <div id="chart_btn">
                                        <div id="chart_btn1">
                                            <span id="chart_title">월간 근무 시간</span>
                                        </div>
                                        <div id="chart_btn2">
                                            <button id="changeChart">차트 변경</button>
                                        </div>
                                    </div>
                                    <div id="chart_div">
                                        <div id="main"></div>
                                        <div id="hoverInfo"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="b_screen_3">
                        <div class="shadow">
                            <div class="com_title">
                                <div class="title" style="background-color: #181F42">
                                    <h4 class="title_text" style="color: white">캘린더</h4>
                                </div>
                            </div>
                            <div class="com_content">
                                <div id="calendar_div">
                                    <div id="cal_btn_div">
                                        <button class="cal_btn" id="all">출근</button>
                                        <button class="cal_btn" id="vacation">
                                            휴가
                                        </button>
                                        <button class="cal_btn" id="meeting">
                                            회의
                                        </button>
                                        <button class="cal_btn" id="business">
                                            출장
                                        </button>
                                    </div>
                                    <div id="cal_div">
                                        <div id='calendar'></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
                <div id="c_screen">
                    <div id="d_screen">
                        <div class="shadow">
                            <div id="b_screen_1_2_1">
                                <div id="on_off_check">
                                    <div id="onoff-grid-container" th:each="item : ${userMap}">
                                        <div class="item">
                                            <table class="onoff_table" th:id="${item.get('user').USERNUM}">
                                                <tr>
                                                    <td rowspan="2" class="img_td">
                                                        <div class="img_td_div">
                                                            <img th:src="@{'/upload/' + ${item.get('user').USERIMAGE}}"alt="유저 프로필 이미지"
                                                                 class="img_list"/>
                                                        </div>
                                                    </td>
                                                    <td class="name_list"
                                                        th:text="${item.get('user').USERNAME}"></td>
                                                    <td class="name_list2">출근</td>
                                                    <td class="name_list2">퇴근</td>
                                                </tr>
                                                <tr>
                                                    <td class="cno_list"
                                                        th:text="${item.get('user').USERENO}"></td>
                                                    <td class="cno_list">
                                                        <div class="on_div"
                                                             th:data-check="${item.get('oncheck')}">
                                                            <div class="on_img">
                                                                <input type="hidden"  th:value="${item.get('userontime')}" th:id="${'ontime'+item.get('user').USERNUM}">
                                                                <div class="tooltip"></div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="cno_list">
                                                        <div class="off_div"
                                                             th:data-check="${item.get('offcheck')}">
                                                            <div class="off_img">
                                                                <input type="hidden"  th:value="${item.get('userofftime')}" th:id="${'offtime'+item.get('user').USERNUM}">
                                                                <div class="tooltip"></div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="e_screen">
                        <div class="shadow">
                            <div class="com_title">
                                <div class="title">
                                    <div class="title_1">
                                    </div>
                                    <div class="title_2">
                                        <h4 class="title_text">공지 게시판</h4>
                                    </div>
                                    <div class="title_3">
                                        <a class="more_text" href="/noticeDept/list">+ 더보기</a>
                                    </div>
                                </div>
                            </div>
                            <div class="com_content">
                                <div class="board">
                                    <div id="notice_div">
                                        <div id="notice-grid-container">
                                            <div class="notice_item" id="nboardList">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="f_screen">
                        <div class="shadow">
                            <div class="com_title">
                                <div class="title">
                                    <div class="title">
                                        <div class="title_1">
                                        </div>
                                        <div class="title_2">
                                            <h4 class="title_text">부서 게시판</h4>
                                        </div>
                                        <div class="title_3">
                                            <a class="more_text" href="/boardDept/list">+ 더보기</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="com_content">
                                <div class="board">
                                    <div id="notice_div">
                                        <div id="notice-grid-container">
                                            <div class="notice_item" ID="dboardList">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="a_screen1"></div>
        </div>
    </div>
    <div class="popup_layer" id="popup_layer">
        <div class="popup_box">
            <!--팝업 컨텐츠 영역-->
            <div class="popup_cont">
                <div class="popup_cont_1">
                    <div id="popup_vacationtype_div"></div>
                    <div id="popup_title_div">
                        <p id="popup_title"></p>
                    </div>
                </div>
                <div class="popup_cont_2">
                    <div id="popup_date_div">
                        <p id="popup_date"></p>
                    </div>
                </div>
                <div class="popup_cont_3">
                    <div class="popup_desc_div">
                        <div id="popup_desc"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<th:block layout:fragment="script">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.2/echarts.min.js"
            integrity="sha512-VdqgeoWrVJcsDXFlQEKqE5MyhaIgB9yXUVaiUa8DR2J4Lr1uWcFm+ZH/YnzV5WqgKf4GPyHQ64vVLgzqGIchyw=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.8/index.global.min.js'></script>
    <script src='js/locales/ko.global.min.js'></script>
    <script src="js/chart.js"></script>
    <script src="js/main.js"></script>
    <script>
        $(function (){
            $.ajax({
                type: 'get',
                url : '/dboardList',
                data: {
                    dept : userDept
                },
                success: function (obj){
                    console.log(obj);
                    if (obj.length == 0) {
                        $('#dboardList').html('부서게시판 글이 없습니다.');
                    } else {
                        let userListHTML = '';
                        for (let i = 0; i < obj.length; i++) {
                            let item = obj[i];
                            userListHTML += `
                                         <table class="notice_table" onclick="location.href='/boardDept/updateCnt/${item.dboardNum}'">
                                                    <tr>
                                                        <td class="notice_td">
                                                            <div class="notice_td_div">
                                                                <div class="notice_type">${item.dboardDept}</div>
                                                            </div>
                                                        </td>
                                                        <td class="notice_title_td">${item.dboardTitle}</td>
                                                        <td class="notice_writer_cnt_td">작성자</td>
                                                        <td class="notice_writer_cnt_td2">${item.dboardWriter}</td>
                                                        <td class="notice_writer_cnt_td">조회수</td>
                                                        <td class="notice_writer_cnt_td2" id="bcnt">${item.dboardCnt}</td>
                                                    </tr>
                                                    <tr>
                                                        <td rowspan="2">
                                                            <div class="notice_img_div">
                                                                <div class="notice_img_div2">
                                                                    <img class="img"
                                                                       src="https://i.ibb.co/60TZMPY/noimage.png">                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td colspan="4" rowspan="2" class="notice_content_td">
                                                            <div class="notice_content_div">
                                                                <div class="notice_content_div2">
                                                                    <span>${item.dboardContent}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td></td>
                                                    </tr>
                                                    <tr>
                                                        <td></td>
                                                    </tr>
                                                </table>
                                    `;
                        }
                        $('#dboardList').html(userListHTML);
                    }
                },
                error: function (err){
                    console.log(err);
                }
            });
            $.ajax({
                type: 'get',
                url : '/nboardList',
                success: function (obj){
                    console.log(obj);
                    if (obj.length == 0) {
                        $('#nboardList').html('공지게시판 글이 없습니다.');
                    } else {
                        let userListHTML = '';
                        for (let i = 0; i < obj.length; i++) {
                            let item = obj[i];
                            userListHTML += `
                                         <table class="notice_table" onclick="location.href='/noticeDept/updateCnt/${item.nboardNum}'">
                                                    <tr>
                                                        <td class="notice_td">
                                                            <div class="notice_td_div">
                                                                <div class="notice_type">전체</div>
                                                            </div>
                                                        </td>
                                                        <td class="notice_title_td">${item.nboardTitle}</td>
                                                        <td class="notice_writer_cnt_td">작성자</td>
                                                        <td class="notice_writer_cnt_td2">${item.nboardWriter}</td>
                                                        <td class="notice_writer_cnt_td">조회수</td>
                                                        <td class="notice_writer_cnt_td2" id="bcnt">${item.nboardCnt}</td>
                                                    </tr>
                                                    <tr>
                                                        <td rowspan="2">
                                                            <div class="notice_img_div">
                                                                <div class="notice_img_div2">
                                                                    <img class="img"
                                                                         src="https://i.ibb.co/60TZMPY/noimage.png">
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td colspan="4" rowspan="2" class="notice_content_td">
                                                            <div class="notice_content_div">
                                                                <div class="notice_content_div2">
                                                                    <span>${item.nboardContent}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td></td>
                                                    </tr>
                                                    <tr>
                                                        <td></td>
                                                    </tr>
                                                </table>
                                    `;
                        }
                        $('#nboardList').html(userListHTML);
                    }
                },
                error: function (err){
                    console.log(err);
                }
            });
            });
    </script>
</th:block>
</html>